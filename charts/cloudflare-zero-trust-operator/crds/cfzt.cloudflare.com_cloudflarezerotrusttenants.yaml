apiVersion: apiextensions.k8s.io/v1
kind: CustomResourceDefinition
metadata:
  name: cloudflarezerotrusttenants.cfzt.cloudflare.com
  annotations:
    controller-gen.kubebuilder.io/version: v0.11.1
spec:
  group: cfzt.cloudflare.com
  names:
    kind: CloudflareZeroTrustTenant
    listKind: CloudflareZeroTrustTenantList
    plural: cloudflarezerotrusttenants
    shortNames:
      - cfzt
      - cfzttenant
    singular: cloudflarezerotrustenant
  scope: Namespaced
  versions:
    - name: v1alpha1
      served: true
      storage: true
      schema:
        openAPIV3Schema:
          type: object
          description: CloudflareZeroTrustTenant represents a Cloudflare account/zone/tunnel configuration
          properties:
            apiVersion:
              type: string
            kind:
              type: string
            metadata:
              type: object
            spec:
              type: object
              required:
                - accountId
                - tunnelId
                - credentialRef
              properties:
                accountId:
                  type: string
                  description: Cloudflare account ID
                  pattern: ^[a-f0-9]{32}$
                tunnelId:
                  type: string
                  description: Default Cloudflare Tunnel ID (UUID)
                  pattern: ^[a-f0-9]{8}-[a-f0-9]{4}-[a-f0-9]{4}-[a-f0-9]{4}-[a-f0-9]{12}$
                zoneId:
                  type: string
                  description: Cloudflare Zone ID (optional)
                  pattern: ^[a-f0-9]{32}$
                credentialRef:
                  type: object
                  description: Reference to Kubernetes Secret containing Cloudflare API token
                  required:
                    - name
                  properties:
                    name:
                      type: string
                      description: Name of the Secret
                    key:
                      type: string
                      description: Key in the Secret containing the API token
                      default: token
                defaults:
                  type: object
                  description: Default values for managed resources
                  properties:
                    sessionDuration:
                      type: string
                      description: Default session duration for Access Applications
                      default: "24h"
                      pattern: ^\d+[smh]$
                    originService:
                      type: string
                      description: Default origin service URL (scheme auto-detected for HTTP/HTTPS)
                      default: ""
                    httpHostHeader:
                      type: string
                      description: HTTP Host header to send to origin
                    originTLS:
                      type: object
                      description: TLS settings for origin connections
                      properties:
                        noTLSVerify:
                          type: boolean
                          description: Disable TLS verification of origin certificate
                          default: false
                        originServerName:
                          type: string
                          description: Hostname that cloudflared should expect from origin server certificate (SNI)
                        caPool:
                          type: string
                          description: Path to CA certificate for origin (if not Cloudflare-signed)
                        tlsTimeout:
                          type: integer
                          description: Timeout in seconds for completing TLS handshake to origin
                          default: 10
                          minimum: 1
                          maximum: 300
                        http2Origin:
                          type: boolean
                          description: Use HTTP/2 to connect to origin (requires HTTPS)
                          default: false
                        matchSNIToHost:
                          type: boolean
                          description: Automatically set SNI to match incoming request hostname
                          default: false
                    httpRedirect:
                      type: boolean
                      description: Enable HTTP to HTTPS redirect
                      default: true
                logLevel:
                  type: string
                  description: Log level for reconciliation of this tenant (DEBUG, INFO, WARNING, ERROR)
                  default: "INFO"
                  enum:
                    - DEBUG
                    - INFO
                    - WARNING
                    - ERROR
            status:
              type: object
              properties:
                observedGeneration:
                  type: integer
                  description: Last observed generation of the spec
                lastSyncTime:
                  type: string
                  format: date-time
                  description: Last successful reconciliation time
                conditions:
                  type: array
                  description: Current conditions
                  items:
                    type: object
                    required:
                      - type
                      - status
                    properties:
                      type:
                        type: string
                        description: Condition type (Ready, Error, etc.)
                      status:
                        type: string
                        enum:
                          - "True"
                          - "False"
                          - Unknown
                        description: Condition status
                      lastTransitionTime:
                        type: string
                        format: date-time
                        description: Last time the condition transitioned
                      reason:
                        type: string
                        description: Machine-readable reason for the condition
                      message:
                        type: string
                        description: Human-readable message
                summary:
                  type: object
                  description: Summary of managed resources
                  properties:
                    managedHTTPRoutes:
                      type: integer
                      description: Number of HTTPRoutes managed by this tenant
                    hostnameRoutes:
                      type: integer
                      description: Number of tunnel hostname routes
                    accessApplications:
                      type: integer
                      description: Number of Access Applications
                    accessPolicies:
                      type: integer
                      description: Number of Access Policies
                    serviceTokens:
                      type: integer
                      description: Number of Service Tokens
      subresources:
        status: {}
      additionalPrinterColumns:
        - name: Account
          type: string
          jsonPath: .spec.accountId
        - name: Tunnel
          type: string
          jsonPath: .spec.tunnelId
        - name: HTTPRoutes
          type: integer
          jsonPath: .status.summary.managedHTTPRoutes
        - name: Last Sync
          type: date
          jsonPath: .status.lastSyncTime
        - name: Ready
          type: string
          jsonPath: .status.conditions[?(@.type=="Ready")].status
        - name: Age
          type: date
          jsonPath: .metadata.creationTimestamp
