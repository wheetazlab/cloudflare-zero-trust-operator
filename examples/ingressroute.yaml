---
# Example IngressRoute with basic hostname route only
apiVersion: traefik.io/v1alpha1
kind: IngressRoute
metadata:
  name: myapp-basic
  namespace: default
  annotations:
    # Enable Cloudflare Zero Trust operator management
    cfzt.cloudflare.com/enabled: "true"
    
    # Select tenant (optional if only one tenant in namespace)
    cfzt.cloudflare.com/tenant: "prod-tenant"
    
    # Public hostname to configure
    cfzt.cloudflare.com/hostname: "myapp.example.com"
    
    # Optional: Override origin service (default from IngressRoute spec or tenant defaults)
    # cfzt.cloudflare.com/originService: "http://myapp.default.svc:8080"
spec:
  entryPoints:
    - web
  routes:
    - match: Host(`myapp.example.com`)
      kind: Rule
      services:
        - name: myapp
          port: 8080

---
# Example IngressRoute with Access Application and Policy
apiVersion: traefik.io/v1alpha1
kind: IngressRoute
metadata:
  name: admin-app
  namespace: default
  annotations:
    cfzt.cloudflare.com/enabled: "true"
    cfzt.cloudflare.com/tenant: "prod-tenant"
    cfzt.cloudflare.com/hostname: "admin.example.com"
    
    # Enable Access Application
    cfzt.cloudflare.com/accessApp: "true"
    
    # Allow specific email addresses
    cfzt.cloudflare.com/allowEmails: "admin@example.com,manager@example.com"
    
    # Session duration
    cfzt.cloudflare.com/sessionDuration: "8h"
spec:
  entryPoints:
    - web
  routes:
    - match: Host(`admin.example.com`)
      kind: Rule
      services:
        - name: admin-panel
          port: 80

---
# Example IngressRoute with Access Application using Groups
apiVersion: traefik.io/v1alpha1
kind: IngressRoute
metadata:
  name: dashboard-app
  namespace: default
  annotations:
    cfzt.cloudflare.com/enabled: "true"
    cfzt.cloudflare.com/tenant: "prod-tenant"
    cfzt.cloudflare.com/hostname: "dashboard.example.com"
    
    # Enable Access Application
    cfzt.cloudflare.com/accessApp: "true"
    
    # Allow specific Cloudflare Access Groups
    cfzt.cloudflare.com/allowGroups: "Engineering,Product"
    
    # Session duration
    cfzt.cloudflare.com/sessionDuration: "12h"
spec:
  entryPoints:
    - web
  routes:
    - match: Host(`dashboard.example.com`)
      kind: Rule
      services:
        - name: dashboard
          port: 3000

---
# Example IngressRoute with Service Token for machine-to-machine auth
apiVersion: traefik.io/v1alpha1
kind: IngressRoute
metadata:
  name: api-service
  namespace: default
  annotations:
    cfzt.cloudflare.com/enabled: "true"
    cfzt.cloudflare.com/tenant: "prod-tenant"
    cfzt.cloudflare.com/hostname: "api.example.com"
    
    # Enable Access Application
    cfzt.cloudflare.com/accessApp: "true"
    
    # Create Service Token for API authentication
    cfzt.cloudflare.com/serviceToken: "true"
    
    # Optional: Also allow specific emails
    cfzt.cloudflare.com/allowEmails: "developer@example.com"
spec:
  entryPoints:
    - web
  routes:
    - match: Host(`api.example.com`)
      kind: Rule
      services:
        - name: api-backend
          port: 8000

---
# Example IngressRoute with all features
apiVersion: traefik.io/v1alpha1
kind: IngressRoute
metadata:
  name: full-featured-app
  namespace: default
  annotations:
    cfzt.cloudflare.com/enabled: "true"
    cfzt.cloudflare.com/tenant: "prod-tenant"
    cfzt.cloudflare.com/hostname: "app.example.com"
    cfzt.cloudflare.com/originService: "http://app-service.app-namespace.svc:8080"
    
    # Access Application with mixed allow rules
    cfzt.cloudflare.com/accessApp: "true"
    cfzt.cloudflare.com/allowGroups: "Admins,Power-Users"
    cfzt.cloudflare.com/allowEmails: "ceo@example.com"
    cfzt.cloudflare.com/sessionDuration: "4h"
    
    # Service Token for machine-to-machine
    cfzt.cloudflare.com/serviceToken: "true"
spec:
  entryPoints:
    - web
    - websecure
  routes:
    - match: Host(`app.example.com`)
      kind: Rule
      services:
        - name: app-service
          namespace: app-namespace
          port: 8080
      middlewares:
        - name: compress
        - name: rate-limit
  tls:
    secretName: app-tls
